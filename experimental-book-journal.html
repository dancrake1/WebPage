<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Photography Journal</title>

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Courier+Prime:wght@400;700&display=swap" rel="stylesheet"/>

  <style>
    :root{
      /* Outer stays the color you like */
      --outer-bg: #ede6d6;

      /* Warmer, lighter paper base (less grey) */
      --paper: #faeed9;  /* try #f8edd6 or #f9ecd7 for tiny shifts */
      
      /* Blob style variables - reuse the exact style you like */
      --blob-color: rgba(224,31,45,0.98);
      --blob-hue-opacity: 0.40;
      --blob-density-opacity: 0.60; 
      --blob-burn-opacity: 0.18;
      --blob-grain-opacity: 0.24;
      --blob-grain2-opacity: 0.12;
    }

    *{margin:0;padding:0;box-sizing:border-box}
    html{scroll-behavior:smooth}

    body{
      font-family:'Courier Prime',monospace;
      background:var(--outer-bg);
      color:#111;
      overflow-x:hidden;
      line-height:1.7;
      position:relative;
    }

    /* Index */
    .index-section{
      min-height:100vh;
      padding:5rem;
      display:flex;
      align-items:center;
      position:relative;
      z-index:10;
      background:var(--outer-bg);
    }
    .hero-image{
      position:absolute; top:22%; right:6%;
      width:500px; height:600px;
      background:url('images/IMG_6354.JPG') center/cover;
      border-radius:6px; opacity:.65; z-index:1;
    }
    .index-container{max-width:800px;width:100%;position:relative;z-index:2}
    .site-header{font-size:1.1rem;margin-bottom:3rem;color:#2a2a2a}
    .index-list{list-style:none;font-size:1.3rem;line-height:1.5;letter-spacing:.02em;color:#111}
    .index-list li{margin-bottom:.8rem}
    .index-list a{text-decoration:none;color:inherit}

    /* Journal wrapper */
    .journal-wrapper{background:var(--outer-bg);padding:4rem 0}

    /* BOOK: match reference – lighter, warmer, with visible grain */
    .journal-content{
      width:95%;
      margin:0 auto;
      position:relative;

      /* Base tone */
      background-color:var(--paper);

      /* Textures + warm tint layer.
         Order matters: tint first (solid), then fibers, then paper grain. */
      background-image:
        linear-gradient(rgba(214,168,111,0.10), rgba(214,168,111,0.10)), /* warm tint */
        url('https://www.transparenttextures.com/patterns/paper-fibers.png'),  /* fibers */
        url('https://www.transparenttextures.com/patterns/paper.png');        /* grain */
      background-repeat: repeat, repeat, repeat;
      background-size: auto, auto, auto;

      /* Make the tint actually warm the textures */
      background-blend-mode: multiply, normal, normal;

      /* Gentle elevation (reduce if you want it flatter) */
      box-shadow:0 2px 12px rgba(0,0,0,.10);
      z-index:1;
    }

    /* Subtle inner vignette + extra fiber pass (so it’s grainy but not grey) */
    .journal-content::before{
      content:'';
      position:absolute; inset:0; pointer-events:none;
      background:
        radial-gradient(120% 120% at 50% 50%, rgba(0,0,0,.035) 0%, rgba(0,0,0,.02) 55%, rgba(0,0,0,.045) 100%),
        url('https://www.transparenttextures.com/patterns/paper-fibers.png');
      mix-blend-mode:multiply;
      opacity:.55; /* lower if still too dark; raise to .65 if you want more grain */
    }

    
    /* Spreads */
    .book-spread{
      position:relative;
      width:100%;
      height:100vh;
      min-height:1400px;
      display:flex;
      background:transparent;
      overflow:hidden;
    }

    /* Spreads */
    .book-spread {
      position: relative;
      width: 100%;
      height: 100vh;
      min-height: 1400px;
      display: flex;
      background: transparent; /* paper is on journal-content */
      overflow: hidden;
    }

    /* Center Spine (as before) */
    .center-spine {
      position: absolute;
      left: 50%;
      top: 0;
      bottom: 0;
      width: 4px;
      transform: translateX(-50%);
      z-index: 100;
      background: linear-gradient(to right,
        rgba(0,0,0,0.09) 0%,
        rgba(0,0,0,0.05) 20%,
        rgba(0,0,0,0.03) 50%,
        rgba(0,0,0,0.05) 80%,
        rgba(0,0,0,0.09) 100%);
    }

    .page-left, .page-right {
      width: 50%;
      height: 100%;
      position: relative;
      padding: 60px;
      overflow: hidden;
      transform-style: preserve-3d;
      z-index: 2;
    }
    .page-left  { transform: perspective(3000px) rotateY(0.5deg);  transform-origin: right center;  padding-right: 64px; }
    .page-right { transform: perspective(3000px) rotateY(-0.5deg); transform-origin: left  center;  padding-left:  64px; }

    /* Gentle page shadows at the spine */
    .page-left::before, .page-right::before{
      content:'';
      position:absolute; top:0; bottom:0; width:20px; z-index:50; pointer-events:none;
    }
    .page-left::before  { right:0;  background: linear-gradient(to left,  rgba(0,0,0,0.10) 0%, rgba(0,0,0,0.05) 50%, transparent 100%); }
    .page-right::before { left:0;   background: linear-gradient(to right, rgba(0,0,0,0.10) 0%, rgba(0,0,0,0.05) 50%, transparent 100%); }

    .book-element { position: absolute; z-index: 10; }

    /* Monospace copy to match inspiration */
    .lorem-block {
      font-family: 'Courier Prime', monospace;
      font-size: 13px;
      line-height: 1.75;
      color: #2a2a2a;
      text-align: left;
      column-count: 2;
      column-gap: 20px;
      opacity: 0.9;
    }
    .lorem-block.single-column{ column-count:1; }

    .bold-interruption,
    .entry-title,
    .book-notes,
    .section-number,
    .metadata-stamp,
    .attribution {
      font-family: 'Courier Prime', monospace;
      letter-spacing: 0.01em;
    }
    .bold-interruption { font-size: 3.5rem; font-weight: 400; line-height: .95; color: #1a1a1a; z-index:70; }
    .section-number   { font-size: 1rem;  opacity: .6; color:#2a2a2a; }
    .entry-title      { font-size: 1.5rem; font-weight: 600; color:#2a2a2a; }
    .book-notes       { font-size: 1.1rem; line-height:1.3; opacity:.85; }
    .metadata-stamp   { font-size: 1.05rem; color:#1a1a1a; }
    .attribution      { font-size: .85rem; color:#2a2a2a; opacity:.7; }
    .black-block      { background: rgba(0,0,0,0.05); }

    /* Images – blend into paper, lift on hover */
    .book-image {
      overflow: hidden;
      cursor: zoom-in;
      position: absolute;
      z-index: 2;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      mix-blend-mode: multiply;              /* printed look */
      transition: filter .25s ease, box-shadow .25s ease, mix-blend-mode .25s ease, transform .25s ease;
      background: transparent;
    }
    /* When an image hosts a colored spot, avoid double-multiplying only on hover */
    .book-image.has-spot:hover { mix-blend-mode: normal; }
    .book-image img { width: 100%; height: 100%; object-fit: cover; display: block; filter: brightness(.96) contrast(.96); }
    .book-image:hover {
      filter: brightness(1) contrast(1);
      mix-blend-mode: normal;                /* rise from page */
      box-shadow: 0 6px 18px rgba(0,0,0,0.18);
    }
    .book-image.spine-adjacent { box-shadow: 0 4px 15px rgba(0,0,0,0.12); }
    .book-image.spine-spanning { box-shadow: 0 6px 20px rgba(0,0,0,0.18); }

    /* Lightbox (unchanged) */
    .lightbox {
      display: none;
      position: fixed; inset: 0;
      background: rgba(251, 248, 243, 0.95);
      z-index: 1000;
      padding: 2rem;
      cursor: zoom-out;
      opacity: 0;
      transition: opacity 0.4s ease-out;
    }
    .lightbox.active { display:flex; align-items:center; justify-content:center; opacity:1; }
    .lightbox-content { width:95vw; height:95vh; transform:scale(.8); transition:transform .4s cubic-bezier(.25,.46,.45,.94); }
    .lightbox.active .lightbox-content { transform:scale(1); }
    .lightbox-content img { width:100%; height:100%; object-fit:contain; }
    .lightbox-close { position:absolute; top:20px; right:40px; color:#1a1a1a; font-size:40px; cursor:pointer; }
    

    /* Container on each photo that will host the spot */
    .book-image { position: absolute; } /* you already have this */
    .book-image .image-spot {
    position: absolute;
    inset: 0;
    pointer-events: none;
    isolation: isolate;           /* keep blends local to this image */
    }

    /* Contained vs. bleed */
    .book-image .image-spot--contained svg { overflow: hidden; }
    .book-image .image-spot--bleed     svg { overflow: visible; }

    /* Size/placement of the SVG over the image (tweak the translate if needed) */
    .book-image .image-spot svg {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    }

    /* Two-layer recipe matching the reference (stronger background interaction) */
    .image-spot .hue-layer     { mix-blend-mode: color;      opacity: 0.40; }
    .image-spot .density-layer { mix-blend-mode: overlay;    opacity: 0.60; }
    .image-spot .burn-layer    { mix-blend-mode: color-burn; opacity: 0.18; }

    /* Add some paper-like grain inside the spot (very subtle) */
    .image-spot .grain { mix-blend-mode: multiply; opacity: 0.24; }
    .image-spot .grain2 { mix-blend-mode: multiply; opacity: 0.12; }

    /* Optional: if you ever have a global blend on .book-image, neutralize it here */
    .book-image .image-spot { mix-blend-mode: unset; }

    /* Mobile */
    @media (max-width: 768px) {
      .hero-image { width: 200px; height: 300px; right: 5%; top: 15%; opacity: .2; }
      .index-list { font-size: 1.1rem; }
      .book-spread { flex-direction: column; height: auto; }
      .page-left, .page-right { width: 100%; padding: 30px; min-height: 100vh; transform: none; }
      .center-spine { display: none; }
    }
  </style>
</head>
<body>
  <!-- Index Section -->
  <section class="index-section">
    <div class="hero-image"></div>
    <div class="index-container">
        <h1 class="site-header">places, faces and databases...<br>fotos</h1>
      <ul class="index-list">
        <li><a href="#spread-1">01 - a sunny day at the beach</a></li>
        <li><a href="#spread-2">02 - india adjacent</a></li>
        <li><a href="#spread-3">03 - a great british strawberry</a></li>
        <li><a href="#spread-4">04</a></li>
        <li><a href="#spread-5">05</a></li>
      </ul>
    </div>
  </section>

  <!-- Journal -->
  <div class="journal-wrapper">
    <div class="journal-content">
      <!-- SPREAD 1 -->
      <div class="book-spread" id="spread-1">
        <div class="center-spine"></div>

        <div class="lorem-block book-element" style="top: 80px; left: 60px; width: 35%; opacity: 0.4;">
          Proin facilisis sapien et libero dapibus interdum. In mollis lorem eu diam malesuada, ut tempus ante convallis. Sed egestas facilisis quam, sit amet.
        </div>
        <span class="section-number book-element" style="top: 20px; left: 40px;">01</span>

        <div class="book-image book-element" style="top:0%; left:0%; width:50%; height:100%;" data-img="images/severn_sisters/hills.jpg">
          <img src="images/severn_sisters/hills.jpg" alt="Hills landscape">
        </div>

        <p class="book-notes book-element" style="bottom: 120px; left: 40px;">fortunately not tottenham...<br></p>
        <p class="book-notes book-element" style="top: 600px; right: 160px;">a pathetic falacy<br></p>

        <div class="book-image book-element" style="top: 20%; left: 50%; width: 16%; height: 28%;" data-img="images/severn_sisters/horse.jpg">
          <img src="images/severn_sisters/horse.jpg" alt="Portrait 1">
        </div>
        <div class="book-image book-element" style="top: 20%; left: 66.5%; width: 16%; height: 28%;" data-img="images/severn_sisters/beems.jpg">
          <img src="images/severn_sisters/beems.jpg" alt="Portrait 2">
        </div>
        <div class="book-image book-element" style="top: 20%; left: 83%; width: 16.3%; height: 28%;" data-img="images/severn_sisters/van.jpg">
          <img src="images/severn_sisters/van.jpg" alt="Portrait 3">
        </div>
        
<div class="book-image book-element" 
     style="top: 60%; left: 50%; width: 40%; height: 30%;" 
     data-img="images/severn_sisters/boat.jpg"
     data-blob="size:2.5,seed:11,rotation:-6,x:750,y:560, bleed:y">
  <img src="images/severn_sisters/boat.jpg" alt="Boat composition">
</div>

        <p class="book-notes book-element" style="bottom: 175px; right: 190px;">the boats!!!<br></p>

      </div>

      <!-- SPREAD 2 -->
      <div class="book-spread" id="spread-2" style="min-height: 3465px;">
        <div class="center-spine"></div>

        <div class="lorem-block book-element" style="top: 100px; left: 60px; width: 38%; height: 400px; opacity: 0.3;">
          Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed vel mauris vitae lectus tincidunt fermentum. Duis cursus tortor sed dolor.
        </div>

        <span class="section-number book-element" style="top: 40px; left: 60px;">02</span>
        <span class="attribution book-element" style="top: 65px; left: 60px;">Dora Lazarevic ©2019</span>

        <div class="book-image book-element" style="top: 0%; left: 50%; width: 50%; height: 20%;" data-img="images/srilanka/train_bleak.jpg">
          <img src="images/srilanka/train_bleak.jpg" alt="Bleak Train">
        </div>

        <div class="book-image book-element" style="top: 14%; left: 0%; width: 50%; height: 25%;" data-img="images/srilanka/tree_light.jpg">
          <img src="images/srilanka/tree_light.jpg" alt="Tree Light">
        </div>

        <p class="book-notes book-element" style="top: 564px; left: 450px;">500 rupee tuk<br></p>

        <div class="book-image book-element" style="top: 24%; left: 50%; width: 25%; height: 15%;" data-img="images/srilanka/fruit.JPG">
          <img src="images/srilanka/fruit.JPG" alt="Fruit">
        </div>

        <div class="book-image book-element" style="top: 41%; left: 40%; width: 45%; height: 25%;" data-img="images/srilanka/train_blur.JPG">
          <img src="images/srilanka/train_blur.JPG" alt="Train Blur">
        </div>

        <div class="book-image book-element" style="top: 43%; left: 8%; width: 22%; height: 12%;" data-img="images/srilanka/woman.JPG">
          <img src="images/srilanka/woman.JPG" alt="Woman">
        </div>

        <div class="book-image book-element" style="top: 68%; left: 0%; width: 50%; height: 25%;" data-img="images/srilanka/beach.jpg">
          <img src="images/srilanka/beach.jpg" alt="Beach">
        </div>

        <div class="book-image book-element" style="top: 68%; right: 30%; width: 22%; height: 12%;" data-img="images/srilanka/boat_shadow.JPG">
          <img src="images/srilanka/boat_shadow.JPG" alt="Surfboard">
        </div>

        <h2 class="bold-interruption book-element" style="bottom: 35%; right: 15%;">India<br>Adjacent</h2>

        <div class="metadata-stamp book-element" style="bottom: 25%; right: 15%;">
          Sri Lanka<br>12/16/19<br>3:14 PM
        </div>
      </div>

      <!-- SPREAD 3 -->
      <div class="book-spread" id="spread-3">
        <div class="center-spine"></div>

        <span class="section-number book-element" style="top: 40px; left: 40px;">03</span>

        <div class="lorem-block book-element single-column" style="top: 100px; right: 80px; width: 35%; opacity: 0.3;">
          Cras cursus hendrerit tellus, vel laoreet eros luctus aliquam. Donec erat libero, sagittis non libero et.
        </div>

        <div class="book-image book-element" style="top: 20%; left: 5%; width: 40%; height: 60%;" data-img="images/severn_sisters/hills.jpg">
          <img src="images/severn_sisters/hills.jpg" alt="Large landscape">
        </div>

        <div class="book-image book-element" style="top: 25%; right: 10%; width: 30%; height: 45%;" data-img="images/severn_sisters/boat.jpg">
          <img src="images/severn_sisters/boat.jpg" alt="Boat composition">
        </div>

        <p class="book-notes book-element" style="bottom: 15%; left: 20%;">composition<br>and framing<br>studies</p>

        <h2 class="bold-interruption book-element" style="top: 40%; right: 15%; font-size: 2rem;">
          A Great British<br>Strawberry
        </h2>
      </div>

      <!-- SPREAD 4 -->
      <div class="book-spread" id="spread-4">
        <div class="center-spine"></div>

        <span class="section-number book-element" style="top: 40px; left: 40px;">MDC 2021</span>

        <div class="lorem-block book-element" style="top: 100px; left: 60px; width: 35%; height: 400px; opacity: 0.4;">
          Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent euismod, nisl eget ultricies tincidunt.
        </div>

        <div class="black-block book-element" style="top: 20%; left: 0; width: 40%; height: 35%;"></div>

        <div class="book-image book-element" style="top: 30%; left: 46%; width: 8%; height: 45%;" data-img="images/severn_sisters/hills.jpg">
          <img src="images/severn_sisters/hills.jpg" alt="Cross spine test">
        </div>

        <div class="book-image book-element" style="bottom: 25%; right: 15%; width: 20%; height: 25%;" data-img="images/severn_sisters/boat.jpg">
          <img src="images/severn_sisters/boat.jpg" alt="Right side detail">
        </div>

        <p class="book-notes book-element" style="bottom: 15%; right: 10%; text-align: right;">mixed<br>compositions</p>

        <div class="metadata-stamp book-element" style="bottom: 80px; left: 60px;">personal trip on film.</div>
      </div>

      <!-- SPREAD 5 -->
      <div class="book-spread" id="spread-5">
        <div class="center-spine"></div>

        <span class="section-number book-element" style="top: 40px; left: 40px;">05</span>

        <div class="lorem-block book-element" style="top: 80px; left: 50%; transform: translateX(-50%); width: 70%; text-align: center; opacity: 0.2;">
          Aliquam consequat sagittis lorem, vel eleifend risus gravida in. Aenean bibendum aliquam orci quis interdum.
        </div>

        <div class="book-image book-element" style="top: 10%; left: 5%; width: 42%; height: 70%;" data-img="images/severn_sisters/hills.jpg">
          <img src="images/severn_sisters/hills.jpg" alt="Final landscape">
        </div>

        <div class="book-image book-element" style="top: 60%; right: 15%; width: 25%; height: 25%;" data-img="images/severn_sisters/boat.jpg">
          <img src="images/severn_sisters/boat.jpg" alt="Final detail">
        </div>

        <h2 class="entry-title book-element" style="bottom: 15%; right: 20%; text-align: center;">Final Portfolio</h2>

        <div class="metadata-stamp book-element" style="bottom: 60px; left: 50%; transform: translateX(-50%);">
          Europe<br>09/03/25<br>London, GB
        </div>
      </div>
    </div>
  </div>

  <!-- Lightbox -->
  <div class="lightbox" id="lightbox">
    <span class="lightbox-close">&times;</span>
    <div class="lightbox-content">
      <img src="" alt="Full view">
    </div>
  </div>

  <script>
    // FIXED: Automatic spine blending - Ultra-tight detection
    function applySpineBlending() {
      document.querySelectorAll('.book-spread').forEach(spread => {
        spread.querySelectorAll('.book-image').forEach(image => {
          const leftStyle = image.style.left || '0%';
          const leftPercent = parseFloat(leftStyle.replace('%', ''));
          const widthStyle = image.style.width || '20%';
          const widthPercent = parseFloat(widthStyle.replace('%', ''));
          const rightPercent = leftPercent + widthPercent;

          const spineZoneLeft = 48;
          const spineZoneRight = 52;

          image.classList.remove('spine-adjacent', 'spine-spanning');
          image.style.transform = '';
          image.style.transformOrigin = '';
          image.querySelectorAll('.spine-shadow').forEach(shadow => shadow.remove());

          if (rightPercent > spineZoneLeft && leftPercent < spineZoneRight) {
            image.classList.add('spine-adjacent');

            if (leftPercent < 50 && rightPercent > 50) {
              image.classList.add('spine-spanning');
              image.style.transform = 'perspective(2000px) rotateX(0.5deg)';

              const centerShadow = document.createElement('div');
              centerShadow.className = 'spine-shadow spine-shadow-center';
              centerShadow.style.cssText = `
                position: absolute;
                left: 45%;
                right: 45%;
                top: 0;
                bottom: 0;
                background: linear-gradient(to right,
                  transparent 0%,
                  rgba(0,0,0,0.3) 30%,
                  rgba(0,0,0,0.5) 50%,
                  rgba(0,0,0,0.3) 70%,
                  transparent 100%);
                pointer-events: none;
                z-index: 5;
              `;
              image.appendChild(centerShadow);
            } else {
              const imageCenter = leftPercent + (widthPercent / 2);
              if (imageCenter < 50) {
                image.style.transformOrigin = 'right center';
                image.style.transform = 'perspective(2000px) rotateY(1.5deg)';

                const shadow = document.createElement('div');
                shadow.className = 'spine-shadow spine-shadow-right';
                shadow.style.cssText = `
                  position: absolute;
                  right: 0;
                  top: 0;
                  bottom: 0;
                  width: 20px;
                  background: linear-gradient(to left,
                    rgba(0,0,0,0.4) 0%,
                    rgba(0,0,0,0.2) 50%,
                    transparent 100%);
                  pointer-events: none;
                  z-index: 5;
                `;
                image.appendChild(shadow);
              } else {
                image.style.transformOrigin = 'left center';
                image.style.transform = 'perspective(2000px) rotateY(-1.5deg)';

                const shadow = document.createElement('div');
                shadow.className = 'spine-shadow spine-shadow-left';
                shadow.style.cssText = `
                  position: absolute;
                  left: 0;
                  top: 0;
                  bottom: 0;
                  width: 20px;
                  background: linear-gradient(to right,
                    rgba(0,0,0,0.4) 0%,
                    rgba(0,0,0,0.2) 50%,
                    transparent 100%);
                  pointer-events: none;
                  z-index: 5;
                `;
                image.appendChild(shadow);
              }
            }
          }
        });
      });
    }

    document.addEventListener('DOMContentLoaded', applySpineBlending);
    window.addEventListener('resize', applySpineBlending);

    // Smooth scroll
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
          target.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
      });
    });

    // Lightbox
    const lightbox = document.getElementById('lightbox');
    const lightboxImg = lightbox.querySelector('img');

    document.querySelectorAll('.book-image').forEach(image => {
      image.addEventListener('click', function() {
        const imgSrc = this.getAttribute('data-img') || this.querySelector('img').src;
        lightboxImg.src = imgSrc;
        lightbox.style.display = 'flex';
        requestAnimationFrame(() => lightbox.classList.add('active'));
      });
    });

    lightbox.addEventListener('click', function() {
      this.classList.remove('active');
      setTimeout(() => { if (!this.classList.contains('active')) this.style.display = 'none'; }, 400);
    });

    // Parallax (very subtle)
    window.addEventListener('scroll', () => {
      const scrolled = window.pageYOffset;
      const spreads = document.querySelectorAll('.book-spread');

      spreads.forEach(spread => {
        const rect = spread.getBoundingClientRect();
        const images = spread.querySelectorAll('.book-image');
        const textElements = spread.querySelectorAll('.book-notes, .section-number, .entry-title');

        if (rect.top < window.innerHeight && rect.bottom > 0) {
          images.forEach(image => {
            const speed = 0.01;
            const yPos = -(scrolled * speed);
            let existingTransform = '';
            if (image.classList.contains('spine-adjacent')) {
              if (image.classList.contains('spine-spanning')) existingTransform = 'perspective(2000px) rotateX(0.5deg)';
              else if (image.style.transform.includes('rotateY(1.5deg)')) existingTransform = 'perspective(2000px) rotateY(1.5deg)';
              else if (image.style.transform.includes('rotateY(-1.5deg)')) existingTransform = 'perspective(2000px) rotateY(-1.5deg)';
            }
            image.style.transform = `${existingTransform} translateY(${yPos}px)`;
          });

          textElements.forEach(text => {
            const textSpeed = 0.005;
            const textYPos = -(scrolled * textSpeed);
            text.style.transform = `translateY(${textYPos}px)`;
          });
        }
      });
    });

    // Fade-in
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => { if (entry.isIntersecting) entry.target.style.opacity = '1'; });
    }, { threshold: 0.1 });

    document.querySelectorAll('.book-element').forEach(element => {
      element.style.opacity = '0';
      element.style.transition = 'opacity 0.8s ease-out';
      observer.observe(element);
    });

    setTimeout(applySpineBlending, 100);

    // Blob generation system
    //  - size: 1.2 = 20% bigger, 0.8 = 20% smaller
    //  - seed: Different numbers = different organic shapes (same number = same shape)
    //  - rotation: -6 = slightly counter-clockwise, 45 = 45° clockwise
    //  - x,y: Position within the image (500,500 = center, 300,200 = upper-left area)
    //  - bleed: y/yes/true = blob can extend beyond image boundaries into journal

    function generateBlobPath(size = 1, seed = 1) {
      const random = (seed) => {
        let x = Math.sin(seed) * 10000;
        return x - Math.floor(x);
      };
      
      // Natural blob parameters with variation
      const baseSize = 200 * size;
      const points = 8;
      const roughness = 0.3;
      const cx = 500, cy = 500;
      
      let path = 'M';
      const angles = [];
      
      for (let i = 0; i < points; i++) {
        const angle = (i / points) * 2 * Math.PI;
        const radiusVariation = 1 + (random(seed + i * 7) - 0.5) * roughness;
        const angleOffset = (random(seed + i * 11) - 0.5) * 0.3;
        
        const radius = baseSize * radiusVariation;
        const actualAngle = angle + angleOffset;
        
        const x = cx + Math.cos(actualAngle) * radius;
        const y = cy + Math.sin(actualAngle) * radius;
        
        angles.push({ x, y, angle: actualAngle });
      }
      
      // Create smooth curves between points
      for (let i = 0; i < points; i++) {
        const curr = angles[i];
        const next = angles[(i + 1) % points];
        const prev = angles[i === 0 ? points - 1 : i - 1];
        
        if (i === 0) path += `${curr.x} ${curr.y}`;
        
        // Control points for smooth curves
        const cp1x = curr.x + Math.cos(curr.angle + Math.PI/2) * baseSize * 0.2;
        const cp1y = curr.y + Math.sin(curr.angle + Math.PI/2) * baseSize * 0.2;
        const cp2x = next.x - Math.cos(next.angle + Math.PI/2) * baseSize * 0.2;
        const cp2y = next.y - Math.sin(next.angle + Math.PI/2) * baseSize * 0.2;
        
        path += ` C${cp1x} ${cp1y}, ${cp2x} ${cp2y}, ${next.x} ${next.y}`;
      }
      path += 'z';
      
      return path;
    }

    function addBlobToImage(imageElement, options = {}) {
      const {
        size = 1,
        seed = Math.random() * 1000,
        rotation = Math.random() * 360,
        position = { x: Math.random() * 400 + 300, y: Math.random() * 400 + 300 },
        bleed = false
      } = options;
      
      if (!imageElement.classList.contains('has-spot')) {
        imageElement.classList.add('has-spot');
      }
      
      const blobPath = generateBlobPath(size, seed);
      const uniqueId = `blob-${Math.floor(Math.random() * 10000)}`;
      
      const spotDiv = document.createElement('div');
      spotDiv.className = bleed ? 'image-spot image-spot--bleed' : 'image-spot image-spot--contained';
      spotDiv.innerHTML = `
        <svg viewBox="0 0 1000 1000" aria-hidden="true">
          <defs>
            <filter id="grain-${uniqueId}" x="-20%" y="-20%" width="140%" height="140%">
              <feTurbulence type="fractalNoise" baseFrequency="0.65" numOctaves="2" seed="${seed}"/>
              <feColorMatrix type="saturate" values="0" />
              <feComponentTransfer>
                <feFuncA type="linear" slope="0.45"/>
              </feComponentTransfer>
            </filter>
            <filter id="grainCoarse-${uniqueId}" x="-20%" y="-20%" width="140%" height="140%">
              <feTurbulence type="fractalNoise" baseFrequency="0.22" numOctaves="2" seed="${seed + 100}"/>
              <feColorMatrix type="saturate" values="0" />
              <feComponentTransfer>
                <feFuncA type="linear" slope="0.28"/>
              </feComponentTransfer>
            </filter>
            <filter id="roughen-${uniqueId}" x="-30%" y="-30%" width="160%" height="160%">
              <feTurbulence type="fractalNoise" baseFrequency="0.018" numOctaves="2" seed="${seed + 200}" result="turb"/>
              <feDisplacementMap in="SourceGraphic" in2="turb" scale="9" xChannelSelector="R" yChannelSelector="G"/>
              <feGaussianBlur stdDeviation="0.9" />
            </filter>
            <radialGradient id="roundFade-${uniqueId}" cx="50%" cy="50%" r="65%">
              <stop offset="0%" stop-color="var(--blob-color)" stop-opacity="0.45"/>
              <stop offset="70%" stop-color="var(--blob-color)" stop-opacity="0.22"/>
              <stop offset="100%" stop-color="var(--blob-color)" stop-opacity="0.00"/>
            </radialGradient>
            <path id="blobPath-${uniqueId}" d="${blobPath}"/>
            <clipPath id="blobClip-${uniqueId}">
              <use href="#blobPath-${uniqueId}" />
            </clipPath>
          </defs>
          <g transform="translate(${position.x - 500}, ${position.y - 500}) rotate(${rotation} 500 500)">
            <use href="#blobPath-${uniqueId}" class="hue-layer" fill="var(--blob-color)" filter="url(#roughen-${uniqueId})" style="opacity: var(--blob-hue-opacity)" />
            <use href="#blobPath-${uniqueId}" class="density-layer" fill="url(#roundFade-${uniqueId})" filter="url(#roughen-${uniqueId})" style="opacity: var(--blob-density-opacity)" />
            <use href="#blobPath-${uniqueId}" class="burn-layer" fill="var(--blob-color)" filter="url(#roughen-${uniqueId})" style="opacity: var(--blob-burn-opacity)" />
            <g clip-path="url(#blobClip-${uniqueId})">
              <use href="#blobPath-${uniqueId}" class="grain" fill="#000" filter="url(#grain-${uniqueId})" style="opacity: var(--blob-grain-opacity)" />
              <use href="#blobPath-${uniqueId}" class="grain2" fill="#000" filter="url(#grainCoarse-${uniqueId})" style="opacity: var(--blob-grain2-opacity)" />
            </g>
          </g>
        </svg>
      `;
      
      imageElement.appendChild(spotDiv);
      return spotDiv;
    }

    // Auto-initialize blobs from HTML attributes
    function initializeBlobs() {
      document.querySelectorAll('.book-image[data-blob]').forEach(image => {
        const blobData = image.getAttribute('data-blob');
        if (blobData === 'true' || blobData === '') {
          // Simple blob with defaults
          addBlobToImage(image);
        } else {
          // Parse blob parameters
          const params = {};
          blobData.split(',').forEach(param => {
            const [key, value] = param.split(':');
            if (key && value) {
              if (key === 'size') params.size = parseFloat(value);
              else if (key === 'seed') params.seed = parseInt(value);
              else if (key === 'rotation') params.rotation = parseFloat(value);
              else if (key === 'bleed') params.bleed = value === 'y' || value === 'yes' || value === 'true';
              else if (key === 'x' || key === 'y') {
                if (!params.position) params.position = {};
                params.position[key] = parseFloat(value);
              }
            }
          });
          addBlobToImage(image, params);
        }
      });
    }

    // Initialize blobs after DOM loads
    document.addEventListener('DOMContentLoaded', initializeBlobs);
  </script>
</body>
</html>